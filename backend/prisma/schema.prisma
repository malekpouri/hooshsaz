generator client {
  provider = "prisma-client-js"
  previewFeatures = ["driverAdapters"]
}

datasource db {
  provider = "postgresql"
}

enum Role {
  USER
  ADMIN
}

enum MessageRole {
  user
  assistant
  system
}

model User {
  id          String   @id @default(uuid())
  username    String   @unique
  fullName    String?
  password    String
  role        Role     @default(USER)
  isProtected Boolean  @default(false) // Prevents deletion of default admin
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  chats       Chat[]
}

model SystemConfig {
  key   String @id
  value String
}

model AIModel {
  id          String   @id @default(uuid())
  name        String   @unique // e.g., "gpt-4", "claude-3"
  provider    String   // e.g., "openai", "anthropic"
  description String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  chats       Chat[]
}

model Chat {
  id        String    @id @default(uuid())
  title     String
  userId    String
  user      User      @relation(fields: [userId], references: [id])
  modelId   String
  model     AIModel   @relation(fields: [modelId], references: [id])
  messages  Message[]
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
}

model Message {
  id        String      @id @default(uuid())
  chatId    String
  chat      Chat        @relation(fields: [chatId], references: [id], onDelete: Cascade)
  role      MessageRole
  content   String
  createdAt DateTime    @default(now())
}
